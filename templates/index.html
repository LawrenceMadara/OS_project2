<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nutritional Insights</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>

<body class="bg-gray-100 font-sans">
    <!-- Header -->
    <header class="bg-blue-600 p-4 text-white">
        <h1 class="text-3xl font-semibold text-center">Nutritional Insights Dashboard</h1>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-6">
        
        <!-- Explore Nutritional Insights Section -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Explore Nutritional Insights</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Bar Chart -->
                <div class="bg-white p-6 shadow-lg rounded-lg">
                    <h3 class="font-semibold mb-2">Bar Chart</h3>
                    <p class="text-sm text-gray-600 mb-4">Average macronutrient content by diet type.</p>
                    <canvas id="barChart" style="max-height: 200px;"></canvas>
                </div>

                <!-- Scatter Plot -->
                <div class="bg-white p-6 shadow-lg rounded-lg">
                    <h3 class="font-semibold mb-2">Scatter Plot</h3>
                    <p class="text-sm text-gray-600 mb-4">Nutrient relationships (e.g., protein vs carbs).</p>
                    <canvas id="scatterChart" style="max-height: 200px;"></canvas>
                </div>

                <!-- Heatmap -->
                <div class="bg-white p-6 shadow-lg rounded-lg">
                    <h3 class="font-semibold mb-2">Heatmap</h3>
                    <p class="text-sm text-gray-600 mb-4">Nutrient correlations.</p>
                    <canvas id="heatmapChart" style="max-height: 200px;"></canvas>
                </div>

                <!-- Pie Chart -->
                <div class="bg-white p-6 shadow-lg rounded-lg">
                    <h3 class="font-semibold mb-2">Pie Chart</h3>
                    <p class="text-sm text-gray-600 mb-4">Recipe distribution by diet type.</p>
                    <canvas id="pieChart" style="max-height: 200px;"></canvas>
                </div>
            </div>
        </section>

        <!-- Filters and Data Interaction -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Filters and Data Interaction</h2>
            
            <div class="flex flex-wrap gap-4 items-center">
                <input type="text" id="searchInput" placeholder="Search by Diet Type" 
                       class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 w-full sm:w-64">
                
                <select id="dietFilter" class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white">
                    <option value="all">All Diet Types</option>
                    <option value="Vegan">Vegan</option>
                    <option value="Keto">Keto</option>
                    <option value="Paleo">Paleo</option>
                    <option value="Vegetarian">Vegetarian</option>
                </select>
            </div>
        </section>

        <!-- API Data Interaction -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">API Data Interaction</h2>
            
            <div class="flex flex-wrap gap-4">
                <button id="getNutritionalInsights" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition">
                    Get Nutritional Insights
                </button>
                <button id="getRecipes" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition">
                    Get Recipes
                </button>
                <button id="getClusters" class="bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700 transition">
                    Get Clusters
                </button>
            </div>

            <div id="apiResponse" class="mt-4 bg-white p-4 shadow rounded hidden">
                <h3 class="text-lg font-semibold mb-2">API Response</h3>
                <pre id="apiContent" class="text-xs bg-gray-100 p-3 rounded overflow-auto max-h-64"></pre>
            </div>
        </section>

        <!-- Security & Compliance -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Security & Compliance</h2>
            
            <div class="bg-white p-6 shadow-lg rounded-lg">
                <h3 class="text-lg font-semibold mb-3">Security Status</h3>
                <div id="securityStatus" class="space-y-1 text-sm">
                    <p>Encryption: <span class="text-green-600 font-semibold">Enabled</span></p>
                    <p>Access Control: <span class="text-green-600 font-semibold">Secure</span></p>
                    <p>Compliance: <span class="text-green-600 font-semibold">GDPR Compliant</span></p>
                </div>
            </div>
        </section>

        <!-- OAuth & 2FA Integration -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">OAuth & 2FA Integration</h2>
            
            <div class="bg-white p-6 shadow-lg rounded-lg">
                <h3 class="text-lg font-semibold mb-4">Secure Login</h3>
                
                <div class="flex flex-wrap gap-4 mb-6">
                    <button id="loginGoogle" class="bg-blue-600 text-white py-2 px-6 rounded hover:bg-blue-700 transition">
                        Login with Google
                    </button>
                    <button id="loginGitHub" class="bg-gray-800 text-white py-2 px-6 rounded hover:bg-gray-900 transition">
                        Login with GitHub
                    </button>
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">Enter 2FA Code</label>
                    <input type="text" id="twoFactorCode" placeholder="Enter your 2FA code" 
                           class="p-2 border rounded w-full focus:ring focus:ring-blue-300">
                </div>
            </div>
        </section>

        <!-- Cloud Resource Cleanup -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Cloud Resource Cleanup</h2>
            
            <div class="bg-white p-6 shadow-lg rounded-lg">
                <p class="text-sm text-gray-700 mb-4">Ensure that cloud resources are efficiently managed and cleaned up post-deployment.</p>
                
                <button id="cleanupBtn" class="bg-red-600 text-white py-2 px-6 rounded hover:bg-red-700 transition">
                    Clean Up Resources
                </button>

                <div id="cleanupStatus" class="mt-4 text-xs text-gray-700 font-mono bg-gray-50 p-3 rounded overflow-y-auto max-h-32 hidden"></div>
            </div>
        </section>

        <!-- Pagination -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Pagination</h2>
            
            <div class="flex justify-center gap-2">
                <button class="bg-gray-300 text-gray-700 py-2 px-4 rounded hover:bg-gray-400 transition">
                    Previous
                </button>
                <button class="bg-blue-600 text-white py-2 px-4 rounded">
                    1
                </button>
                <button class="bg-gray-200 text-gray-700 py-2 px-4 rounded hover:bg-gray-300 transition">
                    2
                </button>
                <button class="bg-gray-300 text-gray-700 py-2 px-4 rounded hover:bg-gray-400 transition">
                    Next
                </button>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-blue-600 p-4 text-white text-center mt-10">
        <p>&copy; 2025 Nutritional Insights. All Rights Reserved.</p>
    </footer>

    <script>
        // ============================================
        // GLOBAL STATE & INITIALIZATION
        // ============================================
        let socket = null;
        let isInitialized = false;

        // Mock data
        const mockData = {
            avgMacros: [
                { Diet_type: 'Vegan', Protein: 15, Carbs: 45, Fat: 12 },
                { Diet_type: 'Keto', Protein: 30, Carbs: 8, Fat: 35 },
                { Diet_type: 'Paleo', Protein: 28, Carbs: 25, Fat: 20 },
                { Diet_type: 'Vegetarian', Protein: 18, Carbs: 40, Fat: 15 }
            ],
            recipes: [
                { name: 'Tofu Scramble', diet: 'Vegan', protein: 22 },
                { name: 'Ribeye Steak', diet: 'Keto', protein: 45 },
                { name: 'Grilled Chicken', diet: 'Paleo', protein: 40 },
                { name: 'Greek Yogurt', diet: 'Vegetarian', protein: 25 }
            ]
        };

        let charts = {};

        // ============================================
        // SOCKET.IO SETUP
        // ============================================
        function initSocket() {
            try {
                socket = io({
                    reconnection: true,
                    reconnectionDelay: 1000,
                    reconnectionAttempts: 5,
                    timeout: 10000
                });

                socket.on('connect', () => {
                    console.log('‚úÖ Socket connected');
                    updateSecurityStatus('Connected', 'green');
                });

                socket.on('connect_error', (err) => {
                    console.warn('‚ö†Ô∏è Connection error:', err.message);
                    updateSecurityStatus('Offline Mode', 'yellow');
                });

                socket.on('disconnect', () => {
                    console.log('üîå Disconnected');
                    updateSecurityStatus('Disconnected', 'red');
                });

                socket.on('progress', (msg) => {
                    console.log('Progress:', msg);
                });

                socket.on('complete', (msg) => {
                    console.log('Complete:', msg);
                });

                socket.on('cleanup_update', (msg) => {
                    const cleanupDiv = document.getElementById('cleanupStatus');
                    if (cleanupDiv && msg) {
                        cleanupDiv.classList.remove('hidden');
                        cleanupDiv.innerHTML += `<p>${msg.status || msg}</p>`;
                        cleanupDiv.scrollTop = cleanupDiv.scrollHeight;
                    }
                });

            } catch (err) {
                console.error('Socket init failed:', err);
                updateSecurityStatus('Offline', 'red');
            }
        }

        function updateSecurityStatus(status, color) {
            const statusDiv = document.getElementById('securityStatus');
            if (statusDiv) {
                const colorClass = color === 'green' ? 'text-green-600' : color === 'yellow' ? 'text-yellow-600' : 'text-red-600';
                statusDiv.innerHTML = `
                    <p>Encryption: <span class="${colorClass} font-semibold">Enabled</span></p>
                    <p>Access Control: <span class="${colorClass} font-semibold">Secure</span></p>
                    <p>Compliance: <span class="${colorClass} font-semibold">GDPR Compliant</span></p>
                    <p class="text-xs text-gray-500 mt-2">Status: ${status}</p>
                `;
            }
        }

        // ============================================
        // CHART CREATION
        // ============================================
        function createBarChart() {
            const ctx = document.getElementById('barChart');
            if (!ctx) return;

            if (charts.bar) charts.bar.destroy();

            charts.bar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: mockData.avgMacros.map(d => d.Diet_type),
                    datasets: [{
                        label: 'Protein (g)',
                        data: mockData.avgMacros.map(d => d.Protein),
                        backgroundColor: 'rgba(59, 130, 246, 0.7)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        function createScatterChart() {
            const ctx = document.getElementById('scatterChart');
            if (!ctx) return;

            if (charts.scatter) charts.scatter.destroy();

            charts.scatter = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Protein vs Carbs',
                        data: mockData.avgMacros.map(d => ({ x: d.Carbs, y: d.Protein })),
                        backgroundColor: 'rgba(34, 197, 94, 0.7)',
                        borderColor: 'rgba(34, 197, 94, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { 
                        x: { title: { display: true, text: 'Carbs (g)' } },
                        y: { title: { display: true, text: 'Protein (g)' } }
                    }
                }
            });
        }

        function createHeatmapChart() {
            const ctx = document.getElementById('heatmapChart');
            if (!ctx) return;

            if (charts.heatmap) charts.heatmap.destroy();

            charts.heatmap = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: mockData.avgMacros.map(d => d.Diet_type),
                    datasets: [
                        {
                            label: 'Protein',
                            data: mockData.avgMacros.map(d => d.Protein),
                            backgroundColor: 'rgba(34, 139, 34, 0.7)'
                        },
                        {
                            label: 'Carbs',
                            data: mockData.avgMacros.map(d => d.Carbs),
                            backgroundColor: 'rgba(255, 159, 64, 0.7)'
                        },
                        {
                            label: 'Fat',
                            data: mockData.avgMacros.map(d => d.Fat),
                            backgroundColor: 'rgba(255, 99, 132, 0.7)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: true, position: 'bottom' } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        function createPieChart() {
            const ctx = document.getElementById('pieChart');
            if (!ctx) return;

            if (charts.pie) charts.pie.destroy();

            charts.pie = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: mockData.avgMacros.map(d => d.Diet_type),
                    datasets: [{
                        data: [25, 30, 20, 25],
                        backgroundColor: [
                            'rgba(34, 139, 34, 0.7)',
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(255, 159, 64, 0.7)',
                            'rgba(75, 192, 192, 0.7)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        function initCharts() {
            createBarChart();
            createScatterChart();
            createHeatmapChart();
            createPieChart();
        }

        // ============================================
        // EVENT HANDLERS
        // ============================================
        document.getElementById('getNutritionalInsights').addEventListener('click', () => {
            const apiDiv = document.getElementById('apiResponse');
            const contentDiv = document.getElementById('apiContent');
            apiDiv.classList.remove('hidden');
            contentDiv.textContent = JSON.stringify(mockData.avgMacros, null, 2);
        });

        document.getElementById('getRecipes').addEventListener('click', () => {
            const apiDiv = document.getElementById('apiResponse');
            const contentDiv = document.getElementById('apiContent');
            apiDiv.classList.remove('hidden');
            contentDiv.textContent = JSON.stringify(mockData.recipes, null, 2);
        });

        document.getElementById('getClusters').addEventListener('click', () => {
            const apiDiv = document.getElementById('apiResponse');
            const contentDiv = document.getElementById('apiContent');
            apiDiv.classList.remove('hidden');
            contentDiv.textContent = JSON.stringify({ clusters: 4, method: 'K-Means' }, null, 2);
        });

        document.getElementById('cleanupBtn').addEventListener('click', () => {
            const cleanupDiv = document.getElementById('cleanupStatus');
            cleanupDiv.classList.remove('hidden');
            cleanupDiv.innerHTML = '<p>‚è≥ Starting cleanup...</p>';
            
            const steps = [
                'üîÑ Scanning resources...',
                'üßπ Removing temporary files...',
                'üóëÔ∏è Clearing cache...',
                '‚úÖ Cleanup complete!'
            ];

            steps.forEach((step, idx) => {
                setTimeout(() => {
                    cleanupDiv.innerHTML += `<p>${step}</p>`;
                    cleanupDiv.scrollTop = cleanupDiv.scrollHeight;
                }, (idx + 1) * 1000);
            });
        });

        document.getElementById('loginGoogle').addEventListener('click', () => {
            alert('Google OAuth login initiated (demo mode)');
        });

        document.getElementById('loginGitHub').addEventListener('click', () => {
            alert('GitHub OAuth login initiated (demo mode)');
        });

        document.getElementById('dietFilter').addEventListener('change', (e) => {
            console.log('Filter changed to:', e.target.value);
        });

        document.getElementById('searchInput').addEventListener('input', (e) => {
            console.log('Search:', e.target.value);
        });

        // ============================================
        // INITIALIZATION
        // ============================================
        window.addEventListener('load', () => {
            if (isInitialized) return;
            isInitialized = true;

            initSocket();
            initCharts();
            updateSecurityStatus('Initializing...', 'yellow');
            
            setTimeout(() => {
                updateSecurityStatus('Active', 'green');
            }, 1000);
        });

        // Real-time updates simulation
        setInterval(() => {
            // Simulate real-time data updates
            if (Math.random() > 0.7) {
                console.log('üîÑ Real-time update received');
            }
        }, 5000);
    </script>
</body>
</html>